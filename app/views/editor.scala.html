@(document: controllers.doc.Document.DocumentData, file: String, compilers: Compilers)

@import helper._

@main(document.name) {
    <div id="docNameDialog" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="docNameLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
        <div class="modal-header">
            <a href="#" class="close" data-dismiss="modal" aria-hidden="true">&times;</a>
            <h3 class="modal-title">Please enter a new title for this document.</h3>
        </div>
        <div class="modal-body">
            <div class="divDialogElements">
                <input id="docNameInput" name="docNameInput" type="text" />
            </div>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>
            <a href="#" class="btn btn-primary" onclick="okClicked ();">OK</a>
        </div>
        </div>
        </div>
    </div>
    <div class="editContainer container">
        <div class="row">
            <div class="col-md-8"><h1 id="docName">@(document.name)</h1></div>
            <div class="col-md-4">
                <div class="input-group">
                    <a data-toggle="modal" href="#docNameDialog" class="btn btn-default"><i class="fa fa-pencil fa-lg"></i></a>
                    <button class="btn btn-default"><i class="fa fa-forward fa-lg" onclick="runAll(doc,compilers)"></i></button>
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button" onclick="saveDoc(doc,compilers)"><i class="fa fa-save fa-lg"></i></button>
                    </span>
                    <input id="filePath" type="text" class="form-control" value="@file">
                </div>
            </div>
        </div>
        <div id="cells"></div>

        <div id="postCells">
            <button id="add" type="button" class="btn btn-default" onclick="addCell(doc,compilers)"><i class="fa fa-plus fa-lg"></i></button>
        </div>
        <script>
            function editorToolbar() {
                return '' +
                    @for(compiler <- compilers) {
                      '      <label class="btn btn-default"><input type="radio" name="mode" value="@{compiler.name}"> @Html(compiler.toolbarIcon)</label>' +
                    }
                    ''
            }

            /* COMPILERS OBJECT */
            var compilers = {};
            @for(c <- compilers) {
               compilers.@{c.name} = {};
               compilers.@{c.name}.hideAfterCompile = @{c.hideAfterCompile};
               compilers.@{c.name}.editor = @Html(c.editorJavascript);
               compilers.@{c.name}.editorToInput = @Html(c.editorToInput);
            }

            /* DOCUMENT OBJECT */
            var doc = newDoc("@(document.name)");
            document.getElementById ("docNameInput").value = doc.name;

                @for(cell <- document.cells) {
                   var format = '@Html(cell.compiler)';
                   var content = '@Html(cell.escapedContent)';
                   addCellFromJson(doc, format, content,compilers);
                }

            $(document).ready(function() {

			});

				$('#docNameDialog').bind('show', function () {
					document.getElementById ("docNameInput").value = doc.name;
					});
                runAll(doc,compilers);

			function okClicked () {
				doc.name = document.getElementById ("docNameInput").value;
				$('#docNameDialog').modal('hide');
				$('#docName').text(doc.name);
			};
        </script>
    </div>
}